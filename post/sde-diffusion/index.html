<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">








    






<link rel="icon" type="image/ico" href="https://zhy-liu.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://zhy-liu.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://zhy-liu.github.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="https://zhy-liu.github.io/android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://zhy-liu.github.io/apple-touch-icon.png">

<meta name="description" content=""/>



<title>
    
    Diffusion Model 的一般SDE框架 | Liu Zhy Blogs
    
</title>

<link rel="canonical" href="https://zhy-liu.github.io/post/sde-diffusion/"/>

<meta property="og:url" content="https://zhy-liu.github.io/post/sde-diffusion/">
  <meta property="og:site_name" content="Liu Zhy Blogs">
  <meta property="og:title" content="Diffusion Model 的一般SDE框架">
  <meta property="og:description" content="只有一种方式能够精确的表示一个规律，那就是微分方程。——理查德·P·费曼">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2026-01-07T00:00:00+00:00">
    <meta property="article:modified_time" content="2026-01-07T00:00:00+00:00">












<link rel="stylesheet" href="/assets/combined.min.56b1873d8852f8a5a109abda36c1bfcde55cb48e5bcbe0d8c934a196a7dc374a.css" media="all">




      <script async src="https://www.googletagmanager.com/gtag/js?id=G-xxxxxxxxx"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-xxxxxxxxx');
        }
      </script>











    




</head>







<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="https://zhy-liu.github.io/">Liu Zhy Blogs</a>
    </h1>

    <div class="header-menu">
        

        
        

        <p
            class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/post" >
                /Blogs
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/about" >
                /about
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      




<div class="breadcrumbs"><a href="/">Home</a><span class="breadcrumbs-separator">/</span><a href="/post/">Posts</a><span class="breadcrumbs-separator">/</span>
        <a href="/post/sde-diffusion/">Diffusion Model 的一般SDE框架</a></div>


<div  class="autonumber" >
  <article>
    <header class="single-intro-container">
        
        <h1 class="single-title">Diffusion Model 的一般SDE框架</h1>
        <p class="single-summary">只有一种方式能够精确的表示一个规律，那就是微分方程。——理查德·P·费曼</p>
        
        <div class="single-subsummary">
          
          <div>
            
            <p class="author">Zhy-Liu </p>
            
            <p class="single-date">
              <time datetime="2026-01-07T00:00:00&#43;00:00">January 7, 2026</time>
              &nbsp; · &nbsp;1 min read
            </p>
          </div>
        </div>
        
    </header>
      <aside class="toc">
        <p><strong>Table of contents</strong></p>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#ddpm和denoising-score-matching的简要回顾">DDPM和Denoising Score Matching的简要回顾</a>
      <ul>
        <li><a href="#ddpm变分视角下的-diffusion-model">DDPM：变分视角下的 Diffusion Model</a></li>
        <li><a href="#denoising-score-matchingdiffusion-model的分数匹配视角">Denoising Score Matching：Diffusion Model的分数匹配视角</a></li>
      </ul>
    </li>
    <li><a href="#diffusion-model之一般sde框架">Diffusion Model之一般SDE框架</a></li>
    <li></li>
  </ul>
</nav>
      </aside>
    
    <div class="single-content">
      <p>本文将从DDPM和Score Matching两个最为经典的Diffusion Model形式出发，梳理出Diffusion Model的一般SDE形式。为此，读者需要掌握VAE的基础知识，并且熟悉VAE中最重要的重参数化（Reparameterization）技巧和KL散度。HVAE的知识不是必要的，但是最好有所了解。</p>
<h2 class="heading" id="ddpm和denoising-score-matching的简要回顾">
  DDPM和Denoising Score Matching的简要回顾
  <a class="anchor" href="#ddpm%e5%92%8cdenoising-score-matching%e7%9a%84%e7%ae%80%e8%a6%81%e5%9b%9e%e9%a1%be">#</a>
</h2>
<h3 class="heading" id="ddpm变分视角下的-diffusion-model">
  DDPM：变分视角下的 Diffusion Model
  <a class="anchor" href="#ddpm%e5%8f%98%e5%88%86%e8%a7%86%e8%a7%92%e4%b8%8b%e7%9a%84-diffusion-model">#</a>
</h3>
<p>DDPM可以说是Diffusion Model的最原始的形式，全称是Denoising Diffusion Probabilistic Model。
DDPM对生成任务的建模分为两个部分，前向过程（forward process）和反向过程（reverse process）。以图像为例，如图1所示，在前向过程中，首先向一张图片$x_0$中不断可控的加入高斯噪声，直到这张图片完全变成一张高斯噪声图$x_L$。而当我们想要生成一张图片的时候，就可以通过随机采样一张高斯噪声的图片，通过这个过程的逆过程（反向过程），不断去噪从而生成一张图片。</p>

<div class="table-outer">
    <table>
        <thead>
            <tr>
                <th style="text-align: center">











<figure class="">

    
    
      
        <div class="img-container" style="--w: 1130; --h: 204;">
            <img loading="lazy" alt="扩散模型示意图" src="/post/imgs/diffusion_sde/noise-add.png" width="1130" height="204">
        </div>
      
    

    
</figure>
</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align: center">











<figure class="">

    
    
      
        <div class="img-container" style="--w: 1116; --h: 205;">
            <img loading="lazy" alt="扩散模型示意图" src="/post/imgs/diffusion_sde/denoising-demo.png" width="1116" height="205">
        </div>
      
    

    
</figure>
</td>
            </tr>
            <tr>
                <td style="text-align: center">图1：扩散模型的建模示意。图片来源：<em>Principles of Diffusion Model</em> by Lai and Song</td>
            </tr>
        </tbody>
    </table>
</div><p>这两个过程虽然简单，但是却满足生成式模型建模本质的特征之一——将随机性添加到建模过程中。这个思想如此简单，但实现起来却需要十分的精细。我们需要将“可控”用数学定义清楚，其次，我们需要找到一种技术手段，能够将这个过程逆转过来，才能完成生成。</p>
<p>用于定义“可控”的数学工具是机器学习中普遍使用的概率论，将加噪过程你转过来的关键技术手段是神经网络技术。</p>
<h4 class="heading" id="前向过程如何将数据转换成噪音">
  前向过程：如何将数据转换成噪音
  <a class="anchor" href="#%e5%89%8d%e5%90%91%e8%bf%87%e7%a8%8b%e5%a6%82%e4%bd%95%e5%b0%86%e6%95%b0%e6%8d%ae%e8%bd%ac%e6%8d%a2%e6%88%90%e5%99%aa%e9%9f%b3">#</a>
</h4>
<p>设一个未知的数据分布为 $p_{data}(x)$，我们假设其服从均值为$\mu$, 方差为$\sigma^2$的高斯分布，即$p_{data}(x) \sim \mathcal{N}(x; \mu, \sigma^2)$。</p>
<p>DDPM的做法是通过将有限的高斯噪声加入到数据当中，生成一系列中间的条件分布$x_t$，$t$为加噪的程度，或者加噪的步数，最终将数据分布转化为一个标准的高斯分布。其中加噪的过程可以用下面的公式表示：</p>
<p>$$x_t = \alpha_t x_{t-1} + \beta_t \epsilon$$</p>
<p>其中$\alpha$和$\beta$满足$\alpha ^ 2 + \beta ^ 2 = 1$，$\epsilon \sim \mathcal{N}(0, I)$，$\alpha$是一组事先定义好的单调递减到0的超参数（满足上述加噪过程的描述）。</p>
<p>也可以写成</p>
<p>$$x_t = \alpha_t x_{t-1} + \sqrt{1 - \alpha_t^2} \epsilon \tag{1}$$</p>
<p>其中$\epsilon \sim \mathcal{N}(0, I)$。</p>
<p>当把一个分布$p_{data}(x)$经过T步加噪之后，我们可以得到T+1个概率分布$p_{data}(x), p_1(x_1), \cdots, p_t(x_t) \cdots p_T(x_T)$，且 $p_T(x_T) \sim \mathcal{N}(0, I)$。</p>

<div class="table-outer">
    <table>
        <thead>
            <tr>
                <th style="text-align: center">











<figure class="">

    
    
      
        <div class="img-container" style="--w: 950; --h: 165;">
            <img loading="lazy" alt="扩散模型的概率分布" src="/post/imgs/diffusion_sde/DDPM-prob.png" width="950" height="165">
        </div>
      
    

    
</figure>
</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align: center">图2：前向过程生成的概率分布。图片来源：<em>Principles of Diffusion Model</em> by Lai and Song</td>
            </tr>
        </tbody>
    </table>
</div><p>由公式(1)，我们也可以得到T个条件概率分布，分别是$p(x_1|x_0), \cdots, p(x_t|x_{t-1}), \cdots, p(x_T|x_{T-1})$。这是一个马尔科夫链。</p>
<p>由于前向过程的加噪是线性操作，因此，我们可以将公式(1)不断递推，一直到$x_0$停止，就可以得到下面直接从$x_0$出发，直接得到第 $t$ 步的概率分布的公式：</p>
<p>$$
x_t = \bar{\alpha_i} x_0 + \sqrt{1 - \bar{\alpha_i} ^ 2} \epsilon \tag{2}
$$</p>
<p>其中$\bar{\alpha_i} = \prod_{k=1}^{i} \alpha_k = \prod_{k=1}^{i} \sqrt{1 - \beta_k^2}$</p>
<p>通过公式(1)和(2)，我们可以得到两个条件概率分布的表达式：</p>
<p>$$
p(x_i|x_{i-1}) = \mathcal{N}(x_i;\sqrt{1-\beta_i^2} x_{i-1}, \beta_i^2 I)
$$</p>
<p>$$
p(x_i|x_0) = \mathcal{N}(x_i;\bar{\alpha_i} x_0, (1 - \bar{\alpha_i} ^2) I) \tag{3}
$$</p>
<h4 class="heading" id="反向过程从噪音生成数据">
  反向过程：从噪音生成数据
  <a class="anchor" href="#%e5%8f%8d%e5%90%91%e8%bf%87%e7%a8%8b%e4%bb%8e%e5%99%aa%e9%9f%b3%e7%94%9f%e6%88%90%e6%95%b0%e6%8d%ae">#</a>
</h4>
<p>对于前向过程的描述已经足够，接下来，需要将这个过程逆过来，完成生成建模。也就是寻找$p(x_{i-1}|x_{i})$的表达式。当我们得到了$p(x_{i-1}|x_{i})$表达式之后，就可以通过使用神经网络近似这个表达式，将整个前向过程反转，达到生成数据的目的。逆向的过程可以通过前向过程结合贝叶斯公式完成：</p>
<p>$$p(x_{i-1}|x_{i}) = p(x_i|x_{i-1}) \frac{p_{i-1}(x_{i-1})}{p_i(x_i)} \tag{4}$$</p>
<p>而神经网络则可以通过最小化反向过程中每个条件概率分布的KL散度来实现：</p>
<p>$$
\min D_{KL}(p(x_{i-1}|x_i)||p_{\phi}(x_{i-1}|x_i))
$$</p>
<p>其中$\phi$是神经网络。</p>
<p>由于$p_{data}$是不知道的，因此公式(3)中的边缘概率分布是不可求的。因此，需要条件化技巧来解决这个问题。</p>
<blockquote>
<p>条件化技巧(Conditioning Technique)：当边缘概率分布不可求时，我们可以通过给定边缘概率分布中的不可求的部分作为条件，从而获得一个有表达式的条件概率分布，而在某些情况下，条件概率分布和边缘概率分布存在着一些好的性质和关系，可以利用这些性质和关系来间接求得或者优化边缘概率分布。</p></blockquote>
<p>给定特定的$x_0$，公式(3)可以写成：</p>
<p>$$</p>
<p>p(x_{i-1}|x_{i},x_0) = p(x_i|x_{i-1},x_0) \frac{p_{i-1}(x_{i-1}|x_0)}{p_i(x_i|x_0)} \tag{5}</p>
<p>$$</p>
<p>通过条件化技巧，公式(5)中的$p_{i-1}(x_{i-1}|x_0)$和$p_i(x_i|x_0)$变得可以计算（公式(3)），因此$p(x_{i-1}|x_{i},x_0)$也是可以计算的了。但是，通过条件化技巧得到的表达式局限于特定的条件，推广到公式(4)上，需要由下面定理的保证。</p>
<h3 class="heading" id="denoising-score-matchingdiffusion-model的分数匹配视角">
  Denoising Score Matching：Diffusion Model的分数匹配视角
  <a class="anchor" href="#denoising-score-matchingdiffusion-model%e7%9a%84%e5%88%86%e6%95%b0%e5%8c%b9%e9%85%8d%e8%a7%86%e8%a7%92">#</a>
</h3>
<h2 class="heading" id="diffusion-model之一般sde框架">
  Diffusion Model之一般SDE框架
  <a class="anchor" href="#diffusion-model%e4%b9%8b%e4%b8%80%e8%88%acsde%e6%a1%86%e6%9e%b6">#</a>
</h2>
<h2 class="heading" id="">
  
  <a class="anchor" href="#">#</a>
</h2>

    </div>
  </article>
    <div class="single-comments">
      <script src="https://giscus.app/client.js"
        data-repo="zhy-liu/zhy-liu.github.io"
        data-repo-id="R_kgDOQSCD8w"
        data-category=""
        data-category-id="DIC_kwDOQSCD884CxmAl"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

    </div>

  

  

  
  

<div class="single-pagination">
    <hr />

    <div class="flexnowrap">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">←</div>
                <div class="single-pagination-text">
                    <a href="/post/okr-2026/">
                        2026年OKR
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
            <div class="single-pagination-container-next">
                <div class="single-pagination-text">
                    <a href="/post/how-to-speak/">
                        如何做好一次演讲
                    </a>
                </div>
                <div class="single-pagination-text">→</div>
            </div>
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  
  





    




  <footer>
    

    
    





    




    
    <p>Powered by
        <a href="https://gohugo.io/">Hugo</a>
        and
        <a href="https://github.com/tomfran/typo">tomfran/typo</a>
    </p>
    
    
    


  </footer>

  
  <link rel="stylesheet" 
  href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css">
  
<script defer 
  src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"></script>

<script defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"
  onload="renderMathInElement(document.body);"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false }
      ]
    });
  });
</script>
  
</body>

<script src="/js/theme-switch.js"></script>
<script defer src="/js/copy-code.js"></script>
</html>
